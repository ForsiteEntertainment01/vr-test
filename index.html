<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>360 Stereo Video Player</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>body { margin:0; background:black; }</style>
  </head>
  <body>

    <div id="overlay" style="position:absolute;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;color:white;font-size:1.5em;background:black;z-index:10;cursor:pointer;">
      Tap to start experience
    </div>

    <video id="vrVideo" playsinline webkit-playsinline muted loop crossorigin="anonymous" style="display:none;">
      <source src="https://vr-streaming-hosting-test.s3.us-east-2.amazonaws.com/HIGH_RES_UNDERWATER_ForyoutubefromMediaEncoder.mp4" type="video/mp4">
    </video>

    <a-scene embedded>
      <a-assets>
        <!-- no <video> here, we use the DOM video element -->
      </a-assets>
      <a-videosphere id="videosphere" src="#vrVideo" stereo="top-bottom" rotation="0 -90 0"></a-videosphere>
      <a-camera position="0 1.6 0"></a-camera>
    </a-scene>

<script>
  const video = document.getElementById('vrVideo');
  const overlay = document.getElementById('overlay');
  const videosphere = document.getElementById('videosphere');

  async function startExperience() {
    try {
      overlay.innerText = "Loading...";
      await video.play();

      overlay.style.display = 'none';
      console.log("Video playback started.");

      // Wait for video to be ready
      const checkReady = setInterval(() => {
        const mesh = videosphere.getObject3D('mesh');

        if (mesh && video.readyState >= 3) {
          clearInterval(checkReady);
          console.log("Mesh and video ready. Applying texture...");

          const texture = new THREE.VideoTexture(video);
          texture.minFilter = THREE.LinearFilter;
          texture.magFilter = THREE.LinearFilter;
          texture.format = THREE.RGBFormat;

          mesh.material.map = texture;
          mesh.material.needsUpdate = true;

          console.log("Video texture applied to mesh.");
        } else {
          console.log("Waiting for mesh/video to be ready...");
        }
      }, 300);
    } catch (error) {
      console.error('Error starting experience:', error);
      overlay.innerText = '⚠️ Tap again to start experience.';
    }
  }

  overlay.addEventListener('click', startExperience);
  overlay.addEventListener('touchend', startExperience);
</script>

  </body>
</html>
