<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>360 Stereo Video Player</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <style>body { margin:0; background:black; }</style>
  </head>
  <body>

    <div id="overlay" style="position:absolute;top:0;left:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;color:white;font-size:1.5em;background:black;z-index:10;cursor:pointer;">
      Tap to start experience
    </div>

    <video id="vrVideo" playsinline webkit-playsinline muted loop crossorigin="anonymous" style="display:none;">
      <source src="https://vr-streaming-hosting-test.s3.us-east-2.amazonaws.com/HIGH_RES_UNDERWATER_ForyoutubefromMediaEncoder.mp4" type="video/mp4">
    </video>

    <a-scene embedded>
      <a-assets>
        <!-- no <video> here, we use the DOM video element -->
      </a-assets>
      <a-videosphere id="videosphere" src="#vrVideo" stereo="top-bottom" rotation="0 -90 0"></a-videosphere>
      <a-camera position="0 1.6 0"></a-camera>
    </a-scene>

    <script>
      const video = document.getElementById('vrVideo');
      const overlay = document.getElementById('overlay');
      const videosphere = document.getElementById('videosphere');

      // This function forces the video texture to update every frame
      function updateVideoTexture() {
        const mesh = videosphere.getObject3D('mesh');
        if (mesh) {
          if (mesh.material.map) {
            mesh.material.map.needsUpdate = true;
          }
        }
        requestAnimationFrame(updateVideoTexture);
      }

      async function startExperience() {
        try {
          await video.play();
          overlay.style.display = 'none';
          updateVideoTexture();
        } catch (e) {
          overlay.innerText = "⚠️ Tap again to start video.";
          console.error('Video play error:', e);
        }
      }

      overlay.addEventListener('click', startExperience);
      overlay.addEventListener('touchend', startExperience);
    </script>
  </body>
</html>
